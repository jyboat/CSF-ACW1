{% extends 'layouts/base.html' %}
{% block body %}

<section class="results container mt-4">
    <h2 class="text-center">Steganography Results & Visualisation</h2>
    <hr>

    {# === Hexadecimal Diff (Cover ‚ü∑ Stego) === #}
    {% set left_url = None %}
    {% set right_url = None %}
    {% if media_type == "img" and cover_filepath and stego_filepath %}
    {% set left_url = url_for('static', filename=cover_filepath) %}
    {% set right_url = url_for('static', filename=stego_filepath) %}
    {% elif media_type == "audio" and cover_audiopath and stego_audiopath %}
    {% set left_url = url_for('static', filename=cover_audiopath) %}
    {% set right_url = url_for('static', filename=stego_audiopath) %}
    {% elif media_type == "mp4" and cover_videopath and stego_videopath %}
    {% set left_url = url_for('static', filename=cover_videopath) %}
    {% set right_url = url_for('static', filename=stego_videopath) %}
    {% endif %}

    <div id="hex-sources" data-left="{{ left_url or '' }}" data-right="{{ right_url or '' }}"></div>

    <div class="card mb-4" id="hex-diff-launch">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div>
                <strong>Hexadecimal Diff</strong> <small class="text-muted">(Cover vs Stego)</small>
                <div class="small text-muted">Open in a dedicated page to avoid freezing on large files.</div>
            </div>
            {% if left_url and right_url %}
            <a href="{{ url_for('hexcompare') }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">Open
                Hex Compare</a>
            {% else %}
            <button class="btn btn-primary" disabled>Not available</button>
            {% endif %}
        </div>
    </div>

    <!-- Hex Diff styles + scripts -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/hex-diff.css') }}">
    <script src="{{ url_for('static', filename='js/hex-diff.js') }}"></script>
    <script>initHexDiff();</script>

    {% if media_type == "img" %}
    <!-- IMAGE DISPLAY -->
    <!-- <div class="row"> -->
    <!-- Cover Object -->
    <!-- <div class="col-md-6">
            <div class="section-box">
                <h5>Original Cover Object</h5>
                <img src="{{ url_for('static', filename=cover_filepath) }}" class="cover-image" id="coverImage">
            </div>
        </div> -->
    <!-- Stego Object -->
    <!-- <div class="col-md-6">
            <div class="section-box">
                <h5>Stego Object</h5> -->
    <!-- <img src="{{ url_for('static', filename=stego_filepath) }}" class="cover-image" id="stegoImage">
            </div> -->
    <!-- </div> -->
    <!-- </div> -->

    <!-- Side-by-side Visual Comparison -->
    {% if diff_visualization_filepath %}
    <div class="row mt-4">
        <div class="col-md-12 text-center">
            <div class="section-box">
                <h6><strong>Cover vs Stego (Difference)</strong></h6>
                <img src="{{ url_for('static', filename=diff_visualization_filepath) }}" class="img-preview"
                    id="imgComparison">
            </div>
        </div>
    </div>
    {% endif %}

    {% if gray_analysis_filepath %}
    <div class="row mt-4">
        <div class="col-md-12 text-center">
            <div class="section-box">
                <h6><strong>Grayscale Intensity Analysis</strong></h6>
                <img src="{{ url_for('static', filename=gray_analysis_filepath) }}" class="img-preview"
                    id="grayAnalysisImage">
            </div>
        </div>
    </div>
    {% endif %}

    <!-- RGB Analysis -->
    {% if rgb_analysis_filepath %}
    <div class="row mt-4">
        <div class="col-md-12 text-center">
            <div class="section-box">
                <h6><strong>RGB Channel Analysis</strong></h6>
                <img src="{{ url_for('static', filename=rgb_analysis_filepath) }}" class="img-preview"
                    id="rgbAnalysisImage">
            </div>
        </div>
    </div>
    {% endif %}

    {% elif media_type == "audio" %}
    <!-- AUDIO DISPLAY -->
    {% if cover_audiopath and stego_audiopath %}
    <div id="audio-data" data-cover="{{ url_for('static', filename=cover_audiopath) }}"
        data-stego="{{ url_for('static', filename=stego_audiopath) }}">
    </div>
    {% endif %}

    <div class="row">
        <!-- Cover Audio -->
        <div class="col-md-6">
            <div class="section-box">
                <h5>Original Audio</h5>
                <div id="waveform-cover"></div>
                <button id="playCover" class="btn btn-primary btn-sm mt-2">Play / Pause</button>
            </div>
        </div>
        <!-- Stego Audio -->
        <div class="col-md-6">
            <div class="section-box">
                <h5>Stego Audio</h5>
                <div id="waveform-stego"></div>
                <button id="playStego" class="btn btn-primary btn-sm mt-2">Play / Pause</button>
            </div>
        </div>
    </div>

    <!-- LSB Waveform Analysis -->
    {% if audio_analysis_filepath %}
    <div class="section-box text-center mt-4">
        <h6><strong>LSB Waveform Signal Difference</strong></h6>
        <img src="{{ url_for('static', filename=audio_analysis_filepath) }}" class="img-preview">
    </div>
    {% endif %}
    {# ================= VIDEO (MP4) ================= #}
    {% elif media_type == "mp4" %}
    {% if cover_videopath and stego_videopath %}
    <div class="row">
        <div class="col-md-6">
            <div class="section-box">
                <h5>Original Video</h5>
                <video src="{{ url_for('static', filename=cover_videopath) }}" controls style="max-width:100%"></video>
            </div>
        </div>
        <div class="col-md-6">
            <div class="section-box">
                <h5>Stego Video</h5>
                <video src="{{ url_for('static', filename=stego_videopath) }}" controls style="max-width:100%"></video>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Bottom Buttons -->
    <div class="mt-4 text-center">
        <a href="/" class="btn btn-secondary">Back to Home</a>
        <a href="static/dummy/diff_map.png" class="btn btn-success" download>Download Visualisation</a>
        {% if media_type == "img" %}
        <a href="{{ url_for('static', filename=stego_filepath) }}" class="btn btn-primary" download>
            Download Image
        </a>
        {% endif %}
        {% if media_type == "audio" %}
        <a href="{{ url_for('static', filename=stego_audiopath) }}" class="btn btn-primary" download>
            Download Audio
        </a>
        {% endif %}
    </div>
</section>



<script src="https://unpkg.com/wavesurfer.js"></script>
<script src="{{ url_for('static', filename='js/results.js') }}" type="text/javascript"></script>
{% endif %}
{% endblock %}