{% extends 'layouts/base.html' %}
{% block body %}

<section class="results container mt-4">
    <h2 class="text-center">Steganography Results & Visualisation</h2>
    <hr>

{# === Hexadecimal Diff (Cover ‚ü∑ Stego) === #}
{% set left_url  = None %}
{% set right_url = None %}
{% if media_type == "img" and cover_filepath and stego_filepath %}
  {% set left_url  = url_for('static', filename=cover_filepath) %}
  {% set right_url = url_for('static', filename=stego_filepath) %}
{% elif media_type == "audio" and cover_audiopath and stego_audiopath %}
  {% set left_url  = url_for('static', filename=cover_audiopath) %}
  {% set right_url = url_for('static', filename=stego_audiopath) %}
{% endif %}

<div id="hex-sources" data-left="{{ left_url or '' }}" data-right="{{ right_url or '' }}"></div>

<div class="card mb-4" id="hex-diff-card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span><strong>Hexadecimal Diff</strong> <small class="text-muted">(Cover vs Stego)</small></span>
    <div class="d-flex gap-3 small text-muted">
      <span><span class="dot diff"></span>diff</span>
      <span><span class="dot ins"></span>insert (only stego)</span>
      <span><span class="dot del"></span>delete (only cover)</span>
    </div>
  </div>
  <div class="card-body p-2">
    <div class="form-check mb-2">
      <input class="form-check-input" type="checkbox" id="hexOnlyDiffs">
      <label class="form-check-label" for="hexOnlyDiffs">Show only rows with diffs</label>
    </div>

    <div class="hex-grid">
      <section class="pane">
        <div class="pane-header bg-light border-bottom px-2 py-1">
          <div class="meta" id="hexMetaLeft">Cover</div>
        </div>
        <div class="hex" id="hexLeft" aria-label="Left hex view"></div>
      </section>
      <section class="pane">
        <div class="pane-header bg-light border-bottom px-2 py-1">
          <div class="meta" id="hexMetaRight">Stego</div>
        </div>
        <div class="hex" id="hexRight" aria-label="Right hex view"></div>
      </section>
    </div>
  </div>
</div>

<!-- Hex Diff styles + scripts -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/hex-diff.css') }}">
<script src="{{ url_for('static', filename='js/hex-diff.js') }}"></script>
<script>initHexDiff();</script>

    {% if media_type == "img" %}
    <!-- IMAGE DISPLAY -->
    <!-- <div class="row"> -->
    <!-- Cover Object -->
    <!-- <div class="col-md-6">
            <div class="section-box">
                <h5>Original Cover Object</h5>
                <img src="{{ url_for('static', filename=cover_filepath) }}" class="cover-image" id="coverImage">
            </div>
        </div> -->
    <!-- Stego Object -->
    <!-- <div class="col-md-6">
            <div class="section-box">
                <h5>Stego Object</h5> -->
    <!-- <img src="{{ url_for('static', filename=stego_filepath) }}" class="cover-image" id="stegoImage">
            </div> -->
    <!-- </div> -->
    <!-- </div> -->

    <!-- Side-by-side Visual Comparison -->
    {% if diff_visualization_filepath %}
    <div class="row mt-4">
        <div class="col-md-12 text-center">
            <div class="section-box">
                <h6><strong>Cover vs Stego (Difference)</strong></h6>
                <img src="{{ url_for('static', filename=diff_visualization_filepath) }}" class="img-preview"
                    id="imgComparison">
            </div>
        </div>
    </div>
    {% endif %}

    {% if gray_analysis_filepath %}
    <div class="row mt-4">
        <div class="col-md-12 text-center">
            <div class="section-box">
                <h6><strong>Grayscale Intensity Analysis</strong></h6>
                <img src="{{ url_for('static', filename=gray_analysis_filepath) }}" class="img-preview"
                    id="grayAnalysisImage">
            </div>
        </div>
    </div>
    {% endif %}

    <!-- RGB Analysis -->
    {% if rgb_analysis_filepath %}
    <div class="row mt-4">
        <div class="col-md-12 text-center">
            <div class="section-box">
                <h6><strong>RGB Channel Analysis</strong></h6>
                <img src="{{ url_for('static', filename=rgb_analysis_filepath) }}" class="img-preview"
                    id="rgbAnalysisImage">
            </div>
        </div>
    </div>
    {% endif %}

    {% elif media_type == "audio" %}
    <!-- AUDIO DISPLAY -->
    {% if cover_audiopath and stego_audiopath %}
    <div id="audio-data" data-cover="{{ url_for('static', filename=cover_audiopath) }}"
        data-stego="{{ url_for('static', filename=stego_audiopath) }}">
    </div>
    {% endif %}

    <div class="row">
        <!-- Cover Audio -->
        <div class="col-md-6">
            <div class="section-box">
                <h5>Original Audio</h5>
                <div id="waveform-cover"></div>
                <button id="playCover" class="btn btn-primary btn-sm mt-2">Play / Pause</button>
            </div>
        </div>
        <!-- Stego Audio -->
        <div class="col-md-6">
            <div class="section-box">
                <h5>Stego Audio</h5>
                <div id="waveform-stego"></div>
                <button id="playStego" class="btn btn-primary btn-sm mt-2">Play / Pause</button>
            </div>
        </div>
    </div>

    <!-- LSB Waveform Analysis -->
    {% if audio_analysis_filepath %}
    <div class="section-box text-center mt-4">
        <h6><strong>LSB Waveform Signal Difference</strong></h6>
        <img src="{{ url_for('static', filename=audio_analysis_filepath) }}" class="img-preview">
    </div>
    {% endif %}
    {% endif %}

    <!-- Bottom Buttons -->
    <div class="mt-4 text-center">
        <a href="/" class="btn btn-secondary">Back to Home</a>
        <a href="static/dummy/diff_map.png" class="btn btn-success" download>Download Visualisation</a>
        {% if media_type == "img" %}
        <a href="{{ url_for('download_bundle') }}" class="btn btn-primary">
            Download Stego Image and Key
        </a>
        {% endif %}
    </div>
</section>



<script src="https://unpkg.com/wavesurfer.js"></script>
<script src="{{ url_for('static', filename='js/results.js') }}" type="text/javascript"></script>

{% endblock %}